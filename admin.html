<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 설정</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      .admin-list {
        margin: 20px 0;
      }
      .admin-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        border-bottom: 1px solid #eee;
      }
      .button {
        background-color: #4285f4;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
      }
      .button:hover {
        background-color: #3367d6;
      }
      .input-group {
        margin: 20px 0;
      }
      input[type="email"] {
        padding: 8px;
        width: 300px;
        margin-right: 10px;
      }
      .status {
        margin: 20px 0;
        padding: 10px;
        border-radius: 4px;
      }
      .status.open {
        background-color: #e6f4ea;
        color: #137333;
      }
      .status.closed {
        background-color: #fce8e6;
        color: #c5221f;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>관리자 설정</h1>
      
      <div class="status" id="reservationStatus">
        현재 예약 상태: 확인 중...
      </div>

      <div class="input-group">
        <input type="email" id="newAdminEmail" placeholder="관리자 이메일 주소">
        <button class="button" onclick="addAdmin()">관리자 추가</button>
      </div>

      <div class="admin-list" id="adminList">
        관리자 목록 로딩 중...
      </div>

      <div class="input-group">
        <h3>예약 시간 설정</h3>
        <input type="datetime-local" id="startTime">
        <input type="datetime-local" id="endTime">
        <button class="button" onclick="setReservationTime()">시간 설정</button>
      </div>

      <button class="button" onclick="toggleReservation()">예약 시작/중지</button>
    </div>

    <script>
      // 페이지 로드 시 초기 데이터 가져오기
      window.onload = function() {
        loadAdminList();
        loadReservationStatus();
        loadReservationTime();
      };

      // 관리자 목록 로드
      function loadAdminList() {
        google.script.run
          .withSuccessHandler(function(admins) {
            const adminList = document.getElementById('adminList');
            adminList.innerHTML = admins.map(admin => `
              <div class="admin-item">
                <span>${admin}</span>
                <button class="button" onclick="removeAdmin('${admin}')">삭제</button>
              </div>
            `).join('');
          })
          .getAdminList();
      }

      // 예약 상태 로드
      function loadReservationStatus() {
        google.script.run
          .withSuccessHandler(function(status) {
            const statusDiv = document.getElementById('reservationStatus');
            statusDiv.textContent = `현재 예약 상태: ${status === 'open' ? '예약 진행 중' : '예약 중지'}`;
            statusDiv.className = `status ${status}`;
          })
          .getReservationStatus();
      }

      // 예약 시간 로드
      function loadReservationTime() {
        google.script.run
          .withSuccessHandler(function(times) {
            document.getElementById('startTime').value = times.start;
            document.getElementById('endTime').value = times.end;
          })
          .getReservationTime();
      }

      // 관리자 추가
      function addAdmin() {
        const email = document.getElementById('newAdminEmail').value;
        if (!email) {
          alert('이메일 주소를 입력해주세요.');
          return;
        }
        
        google.script.run
          .withSuccessHandler(function() {
            document.getElementById('newAdminEmail').value = '';
            loadAdminList();
          })
          .addAdmin(email);
      }

      // 관리자 삭제
      function removeAdmin(email) {
        if (confirm('정말로 이 관리자를 삭제하시겠습니까?')) {
          google.script.run
            .withSuccessHandler(loadAdminList)
            .removeAdmin(email);
        }
      }

      // 예약 시작/중지 토글
      function toggleReservation() {
        google.script.run
          .withSuccessHandler(loadReservationStatus)
          .toggleReservationStatus();
      }

      // 예약 시간 설정
      function setReservationTime() {
        const startTime = document.getElementById('startTime').value;
        const endTime = document.getElementById('endTime').value;
        
        if (!startTime || !endTime) {
          alert('시작 시간과 종료 시간을 모두 입력해주세요.');
          return;
        }

        google.script.run
          .withSuccessHandler(function() {
            alert('예약 시간이 설정되었습니다.');
          })
          .setReservationTime(startTime, endTime);
      }
    </script>
  </body>
</html> 
